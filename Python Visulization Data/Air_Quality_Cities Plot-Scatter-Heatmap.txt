import pandas as pd
import matplotlib.pyplot as plt
import seaborn as sns

# ğŸ“¥ Î¦ÏŒÏÏ„Ï‰ÏƒÎ· Î´ÎµÎ´Î¿Î¼Î­Î½Ï‰Î½
file_path = r"C:\Users\agkap\Desktop\Air_Quality_Cities.csv"
df = pd.read_csv(file_path)

# ğŸ‘€ Î ÏÎ¿ÎµÏ€Î¹ÏƒÎºÏŒÏ€Î·ÏƒÎ·
print("ğŸ”¹ Î ÏÏÏ„ÎµÏ‚ Î³ÏÎ±Î¼Î¼Î­Ï‚ Ï„Î¿Ï… dataset:\n", df.head())

# ğŸ“… ÎœÎµÏ„Î±Ï„ÏÎ¿Ï€Î® Ï„Î·Ï‚ ÏƒÏ„Î®Î»Î·Ï‚ date ÏƒÎµ datetime
df['date'] = pd.to_datetime(df['date'], dayfirst=False)

# ğŸ§¹ ÎˆÎ»ÎµÎ³Ï‡Î¿Ï‚ Î³Î¹Î± ÎºÎµÎ½Î¬ Î´ÎµÎ´Î¿Î¼Î­Î½Î±
print("\nğŸ” Missing Values:\n", df.isnull().sum())

# ğŸ”¥ Î¥Ï€Î¿Î»Î¿Î³Î¹ÏƒÎ¼ÏŒÏ‚ Î¼Î­ÏƒÎ·Ï‚ Ï„Î¹Î¼Î®Ï‚ PM2.5 Î±Î½Î¬ Ï€ÏŒÎ»Î·
avg_pm25_per_city = df.groupby('city')['pm25'].mean().sort_values(ascending=False)
print("\nğŸŒ«ï¸ ÎœÎ­ÏƒÎ· Ï„Î¹Î¼Î® PM2.5 Î±Î½Î¬ Ï€ÏŒÎ»Î·:\n", avg_pm25_per_city)

# ğŸ“† Î¥Ï€Î¿Î»Î¿Î³Î¹ÏƒÎ¼ÏŒÏ‚ Î¼Î·Î½Î¹Î±Î¯Î¿Ï… Î¼Î­ÏƒÎ¿Ï… ÏŒÏÎ¿Ï… PM2.5 (Air Quality Index)
df['year_month'] = df['date'].dt.to_period('M')
monthly_aqi = df.groupby(['year_month', 'city'])['pm25'].mean().reset_index()

# ÎœÎµÏ„Î±Ï„ÏÎ¿Ï€Î® year_month ÏƒÎµ string Î³Î¹Î± Ï„Î¿ plot
monthly_aqi['year_month'] = monthly_aqi['year_month'].astype(str)

# ğŸ“ˆ Î“ÏÎ¬Ï†Î·Î¼Î± 1: Î“ÏÎ±Î¼Î¼Î® Î¼Î·Î½Î¹Î±Î¯Î¿Ï… Î¼Î­ÏƒÎ¿Ï… ÏŒÏÎ¿Ï… PM2.5 Î±Î½Î¬ Ï€ÏŒÎ»Î·
plt.figure(figsize=(12, 6))
sns.lineplot(data=monthly_aqi, x='year_month', y='pm25', hue='city', marker='o')
plt.title(' ÎœÎ·Î½Î¹Î±Î¯Î¿Ï‚ ÎœÎ­ÏƒÎ¿Ï‚ ÎŒÏÎ¿Ï‚ PM2.5 Î±Î½Î¬ Î ÏŒÎ»Î·')
plt.xlabel('ÎœÎ®Î½Î±Ï‚')
plt.ylabel('PM2.5 (Î¼g/mÂ³)')
plt.xticks(rotation=45)
plt.legend(title='Î ÏŒÎ»Î·')
plt.grid(True)
plt.tight_layout()
plt.show()

# ğŸ“‰ Î“ÏÎ¬Ï†Î·Î¼Î± 2: ÎšÎ±Ï„Î±Î½Î¿Î¼Î® PM2.5 Î³Î¹Î± ÏŒÎ»ÎµÏ‚ Ï„Î¹Ï‚ Ï€ÏŒÎ»ÎµÎ¹Ï‚
plt.figure(figsize=(10, 6))
sns.histplot(df['pm25'], bins=30, kde=True, color='salmon')
plt.title('ÎšÎ±Ï„Î±Î½Î¿Î¼Î® PM2.5 Î³Î¹Î± ÎŒÎ»ÎµÏ‚ Ï„Î¹Ï‚ Î ÏŒÎ»ÎµÎ¹Ï‚')
plt.xlabel('PM2.5 (Î¼g/mÂ³)')
plt.ylabel('Î£Ï…Ï‡Î½ÏŒÏ„Î·Ï„Î±')
plt.grid(True)
plt.tight_layout()
plt.show()

# ğŸ”— Î“ÏÎ¬Ï†Î·Î¼Î± 3: Î£Ï…ÏƒÏ‡Î­Ï„Î¹ÏƒÎ· Î¼ÎµÏ„Î±Î¾Ï ÏÏÏ€Ï‰Î½
plt.figure(figsize=(8, 6))
sns.heatmap(df[['pm25', 'no2', 'so2', 'co', 'o3']].corr(), annot=True, cmap='coolwarm')
plt.title(' Î£Ï…ÏƒÏ‡Î­Ï„Î¹ÏƒÎ· ÎœÎµÏ„Î±Î¾Ï Î¡ÏÏ€Ï‰Î½')
plt.tight_layout()
plt.show()

# ğŸ”¥ Extra: Scatter plot NO2 vs PM2.5
plt.figure(figsize=(8, 6))
sns.scatterplot(data=df, x='no2', y='pm25', hue='city')
plt.title('NO2 vs PM2.5 Î±Î½Î¬ Î ÏŒÎ»Î·')
plt.xlabel('NO2 (Î¼g/mÂ³)')
plt.ylabel('PM2.5 (Î¼g/mÂ³)')
plt.legend(title='Î ÏŒÎ»Î·')
plt.grid(True)
plt.tight_layout()
plt.show()
