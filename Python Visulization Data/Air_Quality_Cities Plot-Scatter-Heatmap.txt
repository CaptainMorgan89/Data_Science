import pandas as pd
import matplotlib.pyplot as plt
import seaborn as sns

# 📥 Φόρτωση δεδομένων
file_path = r"C:\Users\agkap\Desktop\Air_Quality_Cities.csv"
df = pd.read_csv(file_path)

# 👀 Προεπισκόπηση
print("🔹 Πρώτες γραμμές του dataset:\n", df.head())

# 📅 Μετατροπή της στήλης date σε datetime
df['date'] = pd.to_datetime(df['date'], dayfirst=False)

# 🧹 Έλεγχος για κενά δεδομένα
print("\n🔍 Missing Values:\n", df.isnull().sum())

# 🔥 Υπολογισμός μέσης τιμής PM2.5 ανά πόλη
avg_pm25_per_city = df.groupby('city')['pm25'].mean().sort_values(ascending=False)
print("\n🌫️ Μέση τιμή PM2.5 ανά πόλη:\n", avg_pm25_per_city)

# 📆 Υπολογισμός μηνιαίου μέσου όρου PM2.5 (Air Quality Index)
df['year_month'] = df['date'].dt.to_period('M')
monthly_aqi = df.groupby(['year_month', 'city'])['pm25'].mean().reset_index()

# Μετατροπή year_month σε string για το plot
monthly_aqi['year_month'] = monthly_aqi['year_month'].astype(str)

# 📈 Γράφημα 1: Γραμμή μηνιαίου μέσου όρου PM2.5 ανά πόλη
plt.figure(figsize=(12, 6))
sns.lineplot(data=monthly_aqi, x='year_month', y='pm25', hue='city', marker='o')
plt.title(' Μηνιαίος Μέσος Όρος PM2.5 ανά Πόλη')
plt.xlabel('Μήνας')
plt.ylabel('PM2.5 (μg/m³)')
plt.xticks(rotation=45)
plt.legend(title='Πόλη')
plt.grid(True)
plt.tight_layout()
plt.show()

# 📉 Γράφημα 2: Κατανομή PM2.5 για όλες τις πόλεις
plt.figure(figsize=(10, 6))
sns.histplot(df['pm25'], bins=30, kde=True, color='salmon')
plt.title('Κατανομή PM2.5 για Όλες τις Πόλεις')
plt.xlabel('PM2.5 (μg/m³)')
plt.ylabel('Συχνότητα')
plt.grid(True)
plt.tight_layout()
plt.show()

# 🔗 Γράφημα 3: Συσχέτιση μεταξύ ρύπων
plt.figure(figsize=(8, 6))
sns.heatmap(df[['pm25', 'no2', 'so2', 'co', 'o3']].corr(), annot=True, cmap='coolwarm')
plt.title(' Συσχέτιση Μεταξύ Ρύπων')
plt.tight_layout()
plt.show()

# 🔥 Extra: Scatter plot NO2 vs PM2.5
plt.figure(figsize=(8, 6))
sns.scatterplot(data=df, x='no2', y='pm25', hue='city')
plt.title('NO2 vs PM2.5 ανά Πόλη')
plt.xlabel('NO2 (μg/m³)')
plt.ylabel('PM2.5 (μg/m³)')
plt.legend(title='Πόλη')
plt.grid(True)
plt.tight_layout()
plt.show()
